<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marshall Street Advisors - Family Office Entry</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header h2 {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .progress-bar {
            height: 4px;
            background: #ecf0f1;
            margin: 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 20%;
            transition: width 0.3s ease;
        }

        .form-container {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }

        .section.hidden {
            display: none;
        }

        .section-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            display: flex;
            align-items: center;
        }

        .section-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }

        .field-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .field {
            margin-bottom: 20px;
        }

        .field.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .required {
            color: #e74c3c;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s ease;
        }

        .checkbox-item:hover {
            background: #f8f9fa;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: space-between;
            margin-top: 40px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .success-message {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 40px;
            text-align: center;
            border-radius: 12px;
            margin: 20px 0;
        }

        .success-message h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .debug-info {
            background: #34495e;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .test-section {
            background: #f39c12;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .test-section button {
            background: white;
            color: #f39c12;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        #hiddenForm {
            display: none;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .field-group {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .form-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Marshall Street Advisors</h1>
            <h2>Family Office Data Entry</h2>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="form-container">
            <!-- Test Section for Debugging -->
            <div class="test-section" id="testSection">
                <strong>🧪 Debug Tools:</strong><br>
                <button onclick="testConnection()">Test Connection</button>
                <button onclick="testFormData()">Test Form Data</button>
                <button onclick="clearDebugLog()">Clear Log</button>
                <button onclick="toggleTestSection()">Hide Tests</button>
            </div>

            <!-- Debug Info Panel -->
            <div class="debug-info" id="debugInfo">
                <strong>Debug Log:</strong><br>
                <span id="debugContent">Form loaded successfully</span>
            </div>
            
            <form id="familyOfficeForm">
                <!-- Section 1: Basic Information -->
                <div class="section" id="section1">
                    <div class="section-title">
                        <span class="section-number">1</span>
                        Basic Information
                    </div>
                    
                    <div class="field-group">
                        <div class="field full-width">
                            <label for="investor">Family Office/Investor Name <span class="required">*</span></label>
                            <input type="text" id="investor" name="investor" required>
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <div class="field">
                            <label for="domain">Website/Domain</label>
                            <input type="url" id="domain" name="domain" placeholder="https://example.com">
                        </div>
                        <div class="field">
                            <label for="msaUser">MSA User (Your Initials) <span class="required">*</span></label>
                            <input type="text" id="msaUser" name="msaUser" maxlength="5" required>
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <div class="field">
                            <label for="mainCountry">Main Country <span class="required">*</span></label>
                            <select id="mainCountry" name="mainCountry" required>
                                <option value="">Select a country</option>
                                <option value="Austria">Austria</option>
                                <option value="Belgium">Belgium</option>
                                <option value="Denmark">Denmark</option>
                                <option value="Finland">Finland</option>
                                <option value="France">France</option>
                                <option value="Germany">Germany</option>
                                <option value="Ireland">Ireland</option>
                                <option value="Netherlands">Netherlands</option>
                                <option value="Norway">Norway</option>
                                <option value="Portugal">Portugal</option>
                                <option value="Sweden">Sweden</option>
                                <option value="Switzerland">Switzerland</option>
                                <option value="United Kingdom">United Kingdom</option>
                            </select>
                        </div>
                        <div class="field">
                            <label for="mainCity">Main City <span class="required">*</span></label>
                            <input type="text" id="mainCity" name="mainCity" required>
                        </div>
                    </div>

                    <div class="field-group">
                        <div class="field">
                            <label for="secondCountry">Second Country (if applicable)</label>
                            <select id="secondCountry" name="secondCountry">
                                <option value="">Select a country</option>
                                <option value="Austria">Austria</option>
                                <option value="Belgium">Belgium</option>
                                <option value="Denmark">Denmark</option>
                                <option value="Finland">Finland</option>
                                <option value="France">France</option>
                                <option value="Germany">Germany</option>
                                <option value="Ireland">Ireland</option>
                                <option value="Netherlands">Netherlands</option>
                                <option value="Norway">Norway</option>
                                <option value="Portugal">Portugal</option>
                                <option value="Sweden">Sweden</option>
                                <option value="Switzerland">Switzerland</option>
                                <option value="United Kingdom">United Kingdom</option>
                            </select>
                        </div>
                        <div class="field">
                            <label for="secondCity">Second City (if applicable)</label>
                            <input type="text" id="secondCity" name="secondCity">
                        </div>
                    </div>
                </div>

                <!-- Section 2: Investment Focus -->
                <div class="section hidden" id="section2">
                    <div class="section-title">
                        <span class="section-number">2</span>
                        Investment Focus
                    </div>
                    
                    <div class="field">
                        <label for="investorCategory">Investor Category</label>
                        <select id="investorCategory" name="investorCategory">
                            <option value="">Select category</option>
                            <option value="Family Office">Family Office</option>
                            <option value="Single Family Office">Single Family Office</option>
                            <option value="Multi Family Office">Multi Family Office</option>
                            <option value="Private Wealth">Private Wealth</option>
                            <option value="Investment Office">Investment Office</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="field">
                        <label>Industries <span class="required">*</span></label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="agtech" name="industries" value="AgTech">
                                <label for="agtech">AgTech</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="consumer" name="industries" value="Consumer Goods">
                                <label for="consumer">Consumer Goods</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="education" name="industries" value="Education">
                                <label for="education">Education</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="financial" name="industries" value="Financial Services">
                                <label for="financial">Financial Services</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="healthcare" name="industries" value="Healthcare">
                                <label for="healthcare">Healthcare</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="internet" name="industries" value="Internet Services">
                                <label for="internet">Internet Services</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="payments" name="industries" value="Payments">
                                <label for="payments">Payments</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="platforms" name="industries" value="Platforms">
                                <label for="platforms">Platforms</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="professional" name="industries" value="Professional Services">
                                <label for="professional">Professional Services</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="realestate" name="industries" value="Real Estate">
                                <label for="realestate">Real Estate</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="software" name="industries" value="Software">
                                <label for="software">Software</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="travel" name="industries" value="Travel and Tourism">
                                <label for="travel">Travel and Tourism</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="field">
                        <label>Investment Stages</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="preseed" name="stages" value="Pre-Seed">
                                <label for="preseed">Pre-Seed</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="seed" name="stages" value="Seed">
                                <label for="seed">Seed</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="seriesa" name="stages" value="Series A">
                                <label for="seriesa">Series A</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="seriesb" name="stages" value="Series B">
                                <label for="seriesb">Series B</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="seriesc" name="stages" value="Series C">
                                <label for="seriesc">Series C</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="growth" name="stages" value="Growth">
                                <label for="growth">Growth</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="latestage" name="stages" value="Late Stage">
                                <label for="latestage">Late Stage</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="field">
                        <label for="overview">Overview/Description</label>
                        <textarea id="overview" name="overview" placeholder="Brief description of the family office's investment focus and background"></textarea>
                    </div>
                </div>

                <!-- Section 3: Primary Contact -->
                <div class="section hidden" id="section3">
                    <div class="section-title">
                        <span class="section-number">3</span>
                        Primary Contact
                    </div>
                    
                    <div class="field-group">
                        <div class="field">
                            <label for="contact1FirstName">First Name <span class="required">*</span></label>
                            <input type="text" id="contact1FirstName" name="contact1FirstName" required>
                        </div>
                        <div class="field">
                            <label for="contact1LastName">Last Name <span class="required">*</span></label>
                            <input type="text" id="contact1LastName" name="contact1LastName" required>
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <div class="field">
                            <label for="contact1Email">Email</label>
                            <input type="email" id="contact1Email" name="contact1Email">
                        </div>
                        <div class="field">
                            <label for="contact1Title">Title</label>
                            <input type="text" id="contact1Title" name="contact1Title">
                        </div>
                    </div>
                    
                    <div class="field">
                        <label for="contact1LinkedIn">LinkedIn</label>
                        <input type="text" id="contact1LinkedIn" name="contact1LinkedIn" placeholder="Full LinkedIn URL or just the profile name">
                    </div>
                </div>

                <!-- Section 4: Secondary Contact -->
                <div class="section hidden" id="section4">
                    <div class="section-title">
                        <span class="section-number">4</span>
                        Secondary Contact (Optional)
                    </div>
                    
                    <div class="field-group">
                        <div class="field">
                            <label for="contact2FirstName">First Name</label>
                            <input type="text" id="contact2FirstName" name="contact2FirstName">
                        </div>
                        <div class="field">
                            <label for="contact2LastName">Last Name</label>
                            <input type="text" id="contact2LastName" name="contact2LastName">
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <div class="field">
                            <label for="contact2Email">Email</label>
                            <input type="email" id="contact2Email" name="contact2Email">
                        </div>
                        <div class="field">
                            <label for="contact2Title">Title</label>
                            <input type="text" id="contact2Title" name="contact2Title">
                        </div>
                    </div>
                    
                    <div class="field">
                        <label for="contact2LinkedIn">LinkedIn</label>
                        <input type="text" id="contact2LinkedIn" name="contact2LinkedIn">
                    </div>
                </div>

                <!-- Section 5: Additional Information -->
                <div class="section hidden" id="section5">
                    <div class="section-title">
                        <span class="section-number">5</span>
                        Additional Information
                    </div>
                    
                    <div class="field">
                        <label for="fundRestrictions">Fund Restrictions</label>
                        <textarea id="fundRestrictions" name="fundRestrictions" placeholder="Any specific restrictions or criteria for investments"></textarea>
                    </div>
                    
                    <div class="field">
                        <label for="fundRestrictionNotes">Fund Restriction Notes</label>
                        <textarea id="fundRestrictionNotes" name="fundRestrictionNotes"></textarea>
                    </div>
                    
                    <div class="field">
                        <label for="portfolio">Portfolio Notes</label>
                        <textarea id="portfolio" name="portfolio" placeholder="Notable portfolio companies or investment examples"></textarea>
                    </div>
                    
                    <div class="field">
                        <label for="categories">Categories/Tags</label>
                        <input type="text" id="categories" name="categories" placeholder="Additional tags or categories (comma-separated)">
                    </div>
                </div>

                <div class="error-message" id="errorMessage"></div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousSection()" style="display: none;">
                        ← Previous
                    </button>
                    <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextSection()">
                        Next →
                    </button>
                    <button type="button" class="btn btn-primary" id="submitBtn" style="display: none;" onclick="handleSubmit()">
                        Submit Entry
                    </button>
                </div>
            </form>

            <!-- Hidden form for actual submission -->
            <form id="hiddenForm" method="POST" target="hiddenIframe">
                <!-- Hidden inputs will be populated by JavaScript -->
            </form>
            <iframe name="hiddenIframe" style="display: none;"></iframe>

            <div class="success-message" id="successMessage" style="display: none;">
                <h3>✅ Successfully Submitted!</h3>
                <p>Thank you! Your family office data has been submitted for review and will be processed shortly.</p>
                <button class="btn btn-primary" onclick="resetForm()" style="margin-top: 20px;">Submit Another Entry</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration - UPDATE THIS WITH YOUR ACTUAL WEB APP URL
        const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbz52V4lDsof0PPiiwbJOPkhc99QimMDQo8bKmvLreb6Ydl11wBCpzfiOG_7zEhX-lYB/exec';
        
        let currentSection = 1;
        const totalSections = 5;

        function debugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            console.log('DEBUG:', message);
            const debugDiv = document.getElementById('debugInfo');
            const debugContent = document.getElementById('debugContent');
            debugContent.innerHTML += '<br>' + timestamp + ': ' + message;
            
            // Auto-scroll to bottom
            debugDiv.scrollTop = debugDiv.scrollHeight;
        }

        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('DOM Content Loaded');
            updateProgressBar();
            updateButtons();
            debugLog('Form initialization complete');
        });

        // Test functions for debugging
        function testConnection() {
            debugLog('Testing connection to Google Apps Script...');
            
            // Test with GET request first
            fetch(WEBAPP_URL)
                .then(response => response.json())
                .then(data => {
                    debugLog('✅ Connection test successful: ' + JSON.stringify(data));
                })
                .catch(error => {
                    debugLog('❌ Connection test failed: ' + error.message);
                });
        }

        function testFormData() {
            debugLog('Testing form data collection...');
            
            // Fill form with test data
            document.getElementById('investor').value = 'Test Family Office';
            document.getElementById('msaUser').value = 'TEST';
            document.getElementById('mainCountry').value = 'United Kingdom';
            document.getElementById('mainCity').value = 'London';
            document.getElementById('contact1FirstName').value = 'John';
            document.getElementById('contact1LastName').value = 'Doe';
            
            // Select some industries
            document.getElementById('software').checked = true;
            document.getElementById('financial').checked = true;
            
            debugLog('✅ Test data populated');
            
            // Test data collection
            const testData = collectFormData();
            debugLog('Collected data: ' + JSON.stringify(testData, null, 2));
        }

        function clearDebugLog() {
            document.getElementById('debugContent').innerHTML = 'Debug log cleared';
        }

        function toggleTestSection() {
            const testSection = document.getElementById('testSection');
            testSection.style.display = testSection.style.display === 'none' ? 'block' : 'none';
        }

        function collectFormData() {
            debugLog('Collecting form data...');
            
            const formData = new FormData(document.getElementById('familyOfficeForm'));
            
            // Convert checkboxes to comma-separated strings
            const industries = Array.from(document.querySelectorAll('input[name="industries"]:checked'))
                .map(cb => cb.value).join(', ');
            const stages = Array.from(document.querySelectorAll('input[name="stages"]:checked'))
                .map(cb => cb.value).join(', ');

            debugLog('Industries: ' + industries);
            debugLog('Stages: ' + stages);

            // Create submission object
            const submission = {};
            
            // Get all form fields
            for (let [key, value] of formData.entries()) {
                submission[key] = value;
            }
            
            // Override checkboxes with comma-separated values
            submission.industries = industries;
            submission.stages = stages;
            
            // Add metadata
            submission.approved = 'Pending';
            submission.created = new Date().toISOString();
            
            return submission;
        }

        function updateProgressBar() {
            const progress = (currentSection / totalSections) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            prevBtn.style.display = currentSection > 1 ? 'block' : 'none';
            
            if (currentSection === totalSections) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
                debugLog('Submit button should now be visible');
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
            }
        }

        function showSection(sectionNumber) {
            debugLog(`Showing section ${sectionNumber}`);
            
            // Hide all sections
            for (let i = 1; i <= totalSections; i++) {
                document.getElementById(`section${i}`).classList.add('hidden');
            }
            
            // Show current section
            document.getElementById(`section${sectionNumber}`).classList.remove('hidden');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        function nextSection() {
            debugLog('Next section clicked');
            if (validateCurrentSection()) {
                currentSection++;
                showSection(currentSection);
                updateProgressBar();
                updateButtons();
            }
        }

        function previousSection() {
            debugLog('Previous section clicked');
            currentSection--;
            showSection(currentSection);
            updateProgressBar();
            updateButtons();
        }

        function validateCurrentSection() {
            debugLog(`Validating section ${currentSection}`);
            
            const currentSectionElement = document.getElementById(`section${currentSection}`);
            const requiredFields = currentSectionElement.querySelectorAll('[required]');
            let isValid = true;
            let errorMessage = '';

            // Clear previous error styles
            requiredFields.forEach(field => {
                field.style.borderColor = '#ddd';
            });

            // Validate required fields
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = '#e74c3c';
                    isValid = false;
                    errorMessage = 'Please fill in all required fields marked with *';
                }
            });

            // Special validation for industries (at least one checkbox must be selected)
            if (currentSection === 2) {
                const industriesChecked = document.querySelectorAll('input[name="industries"]:checked');
                if (industriesChecked.length === 0) {
                    isValid = false;
                    errorMessage = 'Please select at least one industry';
                }
            }

            // Show error message if validation fails
            const errorDiv = document.getElementById('errorMessage');
            if (!isValid) {
                errorDiv.textContent = errorMessage;
                errorDiv.style.display = 'block';
                debugLog('Validation failed: ' + errorMessage);
            } else {
                errorDiv.style.display = 'none';
                debugLog('Validation passed');
            }

            return isValid;
        }

        function handleSubmit() {
            debugLog('🚀 SUBMIT BUTTON CLICKED!');
            
            // Validate one more time
            if (!validateCurrentSection()) {
                debugLog('Final validation failed, stopping submission');
                return;
            }

            debugLog('Final validation passed, starting submission...');
            submitForm();
        }

        function submitForm() {
            debugLog('submitForm() function started');
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';
                debugLog('Submit button disabled and text changed');

                // Collect form data
                const submission = collectFormData();
                debugLog('Submission data prepared');
                debugLog('Key fields check: ' + submission.investor + ', ' + submission.msaUser + ', ' + submission.mainCountry + ', ' + submission.contact1FirstName);

                // Create form for submission
                const hiddenForm = document.getElementById('hiddenForm');
                hiddenForm.innerHTML = ''; // Clear previous inputs
                hiddenForm.action = WEBAPP_URL;
                
                // Add all data as hidden inputs
                Object.keys(submission).forEach(key => {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = submission[key] || '';
                    hiddenForm.appendChild(input);
                });
                
                debugLog('Hidden form populated with ' + Object.keys(submission).length + ' fields');
                
                // Set up iframe handlers
                const iframe = document.getElementsByName('hiddenIframe')[0];
                
                let submitted = false;
                
                // Success handler
                iframe.onload = function() {
                    if (!submitted) return; // Ignore initial load
                    
                    debugLog('✅ Form submitted via iframe - assuming success');
                    
                    setTimeout(() => {
                        document.getElementById('familyOfficeForm').style.display = 'none';
                        document.getElementById('successMessage').style.display = 'block';
                        document.getElementById('debugInfo').style.display = 'none';
                        document.getElementById('testSection').style.display = 'none';
                    }, 1000);
                };
                
                // Error handler
                iframe.onerror = function() {
                    debugLog('❌ Error during iframe submission');
                    showError('Submission failed. Please try again.');
                    
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                };
                
                // Submit the form
                debugLog('Submitting form to: ' + WEBAPP_URL);
                submitted = true;
                hiddenForm.submit();
                
                // Fallback timeout
                setTimeout(() => {
                    if (submitBtn.disabled) {
                        debugLog('⚠️ Fallback timeout - assuming success after 5 seconds');
                        document.getElementById('familyOfficeForm').style.display = 'none';
                        document.getElementById('successMessage').style.display = 'block';
                        document.getElementById('debugInfo').style.display = 'none';
                        document.getElementById('testSection').style.display = 'none';
                    }
                }, 5000);

            } catch (error) {
                debugLog('❌ EXCEPTION: ' + error.message);
                console.error('Submit exception:', error);
                
                showError('Error preparing submission: ' + error.message);
                
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function resetForm() {
            debugLog('Reset form called');
            
            // Reset form
            document.getElementById('familyOfficeForm').reset();
            
            // Reset to first section
            currentSection = 1;
            showSection(1);
            updateProgressBar();
            updateButtons();
            
            // IMPORTANT: Re-enable and reset submit button
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Entry';
            
            // Also reset next button in case it was disabled
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.disabled = false;
            nextBtn.textContent = 'Next →';
            
            // Hide success message and show form
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('familyOfficeForm').style.display = 'block';
            document.getElementById('debugInfo').style.display = 'block';
            document.getElementById('testSection').style.display = 'block';
            
            // Hide error message
            document.getElementById('errorMessage').style.display = 'none';
            
            // Clear any field error styling
            const allInputs = document.querySelectorAll('input, select, textarea');
            allInputs.forEach(field => {
                field.style.borderColor = '#ddd';
            });
            
            // Clear debug info
            document.getElementById('debugContent').innerHTML = 'Form reset - ready for new entry';
            
            debugLog('✅ Form reset complete - all buttons re-enabled');
        }

        debugLog('Script loaded successfully');
    </script>
</body>
</html>